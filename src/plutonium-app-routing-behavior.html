<link rel="import" href="plutonium-app-layout-behavior.html">

<script>
    (function () {
        'use strict';

        window.PlutoniumBehaviors = window.PlutoniumBehaviors || {};

        /**
         * Provides application routing behavior with `<app-route>`.
         *
         * @polymerBehavior
         */
        PlutoniumBehaviors.AppRoutingBehaviorImpl = {
            properties: {
                page: {
                    type: String,
                    reflectToAttribute: true,
                    observer: '_pageChanged'
                },
                homePage: {
                    type: String,
                    notify: true
                },
                loginPage: {
                    type: String,
                    notify: true
                },
                applicationDomain: {
                    type: String,
                    notify: true
                },
                authenticated: {
                    type: Boolean,
                    notify: true
                }
            },
            observers: [
                '_routePageChanged(routeData.page)',
            ],
            listeners: {
                'page-go': '_onNavigate'
            },
            ready: function () {
                this._resetLayout();
            },
            /**
             * Page changed event handler.
             * @param {String} page
             * @returns {undefined}
             */
            _routePageChanged: function (page) {
                console.log(this.is, 'navigate to', page);
                if (this.authenticated) {
                    this.page = page || this.homePage;
                } else {
                    this.page = this.loginPage;
                }
            },
            /**
             * Page changed observer.
             * @param {String} page
             * @returns {undefined}
             */
            _pageChanged: function (page) {
                // Load page import on demand. Show 404 page if fails
                var resolvedPageUrl = this.resolveUrl(this.applicationDomain + '-' + page + '.html');
                this.importHref(resolvedPageUrl, null, this._showPage404, true);
                console.log(this.is, 'page changed', page);
                this._resetLayout();
            },
            /**
             * Page 404.
             * @param {String} page
             * @returns {undefined}
             */
            _showPage404: function () {
                console.log(this.is, 'not found', this.page, 'page');
                this.page = 'view404';
            },
            _onNavigate: function (event, detail) {
                console.log(this.is, 'navigate to', detail.page);
                this.set('route.path', '/' + detail.page);
            }

        };

        PlutoniumBehaviors.AppRoutingBehavior = [
            PlutoniumBehaviors.AppLayoutBehavior,
            PlutoniumBehaviors.AppRoutingBehaviorImpl
        ];
    })();
</script>