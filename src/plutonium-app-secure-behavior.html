<script>
    (function () {
        'use strict';

        window.PlutoniumBehaviors = window.PlutoniumBehaviors || {};

        /**
         * Provides application toasing behavior with `<paper-toast id="mainToast">`.
         *
         * @polymerBehavior
         */
        PlutoniumBehaviors.AppSecurityBehavior = {
            properties: {
                token: {
                    type: Object,
                    notify: true
                },
                headers: {
                    type: Object,
                    notify: true
                },
                user: {
                    type: Object,
                    notify: true,
                    value: {
                        principal: {
                            token: ''
                        }
                    }
                }
            },
            observers: [
                'observeAuthorizationHeaders(token)',
                'observeAccountId(user.principal)'
            ],
            observeAuthorizationHeaders: function (token) {
                
                this.headers = {
                    'X-Auth-Token': token.token,
                    'X-XSRF-TOKEN': this.$.xsrfCookie.readCookie()
                }
                console.log(this.is, 'set authorization header', token);
            },
            observeAccountId: function(principal) {
                this.accountId = principal.token;
            },
            onLogout: function () {
                console.log(this.is, 'logout ...');
                this.$.logoutAjax.generateRequest();
                this.$.tokenAjax.generateRequest();
            },
            onLogoutResponse: function () {
                this.authenticated = false;
                console.log(this.is, 'logout successful');
                this.fire('page-go', {
                    page: 'login-view'
                });
            },
            onLogoutError: function () {

                this.fire('feedback', {
                    text: 'Logout failed.'
                });
            }
        };
    })();
</script>