<link rel="import" href="plutonium-widget-bound-beavior.html">
<link rel="import" href="plutonium-app-routing-behavior.html">

<script>
    (function () {
        'use strict';

        window.WonderjamAppBehaviors = window.WonderjamAppBehaviors || {};

        /**
         * Article controller behavior,
         *
         * @polymerBehavior
         */
        WonderjamAppBehaviors.ControllerArticleBehaviorImpl = {
            properties: {
                /**
                 * Root article.
                 * @type {{elements: Array<HTMLElement>, level: number}}
                 */
                rootModel: {
                    type: Object,
                    notify: true
                },
                /**
                 * Array for parent articles path.
                 * @type {{elements: Array<HTMLElement>, level: number}}
                 */
                parentModel: {
                    type: Object,
                    notify: true
                },
                /**
                 * Array for article content chidren.
                 * @type {{elements: Array<HTMLElement>, level: number}}
                 */
                contentChildrenModel: {
                    type: Object,
                    notify: true
                },
                /**
                 * Table of contents request parameters.
                 * @type {{pageId: String, tag: String, owner: String}}
                 */
                tocRequestParams: {
                    type: Object,
                    notify: true
                },
                /**
                 * Article information request parameters.
                 * @type {{pageId: String}}
                 */
                infoRequestParams: {
                    type: Object,
                    notify: true
                },
                /**
                 * Sub-route parameters for members page.
                 * @type {{elements: Array<HTMLElement>, level: number}}
                 */
                contentSubrouteData: {
                    type: Object,
                    notify: true
                },
                /**
                 * Sub-route parameters for members page.
                 * @type {{elements: Array<HTMLElement>, level: number}}
                 */
                contentDetailsSubrouteData: {
                    type: Object,
                    notify: true
                }

            },
            observers: [
                'observeContentSubrouteData(accountId, contentSubrouteData.contentId, selectedContentFolder)'
            ],
            listeners: {
                'article-details': 'onDetails'
            },
            /**
             * Content page sub routing observer.
             * @param {{contentId: String}} contentSubrouteData
             * @param {String} selectedContentFolder
             * @returns {undefined}
             */
            observeContentSubrouteData: function (accountId, contentId, selectedContentFolder) {
                console.log(this.is, 'observe route', this.contentSubrouteData);
                this.tocRequestParams.pageId = contentId;
                this.tocRequestParams.tag = selectedContentFolder;
                this.tocRequestParams.owner = accountId;
            },
            onDetails: function (event, details) {
//                this.page = 'article-section';
//                this.contentSubrouteData.contentId = contentSubrouteData.contentId;
                this.set('route.path', '/article-section/' + details.contentId);
//                this.set('articleRouteData.pageId', details.contentId);
//                this.set('page', 'article-section');
//                this.set('contentDetailsSubrouteData.contentId', contentSubrouteData.contentId);

            },
            /**
             * Ajax response handler for `childTocAjax` element.
             */
            onArticleAjaxResponse: function (event, detail) {
                console.log(this.is, 'fetched article details for', this.contentDetailsSubrouteData);
            },
            /**
             * Ajax error handler for `childTocAjax` element.
             */
            onArticleAjaxError: function (event, detail) {
                console.error(this.is, 'article details fetching failed for', this.contentDetailsSubrouteData);
            },
            /**
             * Ajax response handler for `childTocAjax` element.
             */
            onChildTocAjaxResponse: function (event, detail) {
                console.log(this.is, 'fetched article child contents for', this.contentSubrouteData);
            },
            /**
             * Ajax error handler for `childTocAjax` element.
             */
            onChildTocAjaxError: function (event, detail) {
                console.error(this.is, 'article child contents fetching failed for', this.contentSubrouteData);
            },
            /**
             * Ajax response handler for `parentTocAjax` element.
             */
            onParentTocAjaxResponse: function (event, detail) {
                console.log(this.is, 'fetched article parent path for', this.contentSubrouteData);
            },
            /**
             * Ajax error handler for `parentTocAjax` element.
             */
            onParentTocAjaxError: function (event, detail) {
                console.error(this.is, 'article parent path fetching failed for', this.contentSubrouteData);
                this.selectedContentFolder = 'public';
//                this._showPage401();
            }

        };


        WonderjamAppBehaviors.ControllerArticleBehavior = [
            PlutoniumBehaviors.WidgetBoundBehavior,
            PlutoniumBehaviors.AppRoutingBehavior,
            WonderjamAppBehaviors.ControllerArticleBehaviorImpl
        ];

    })();
</script>